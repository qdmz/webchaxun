# WebæŸ¥è¯¢ç³»ç»Ÿ - äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ðŸ“‹ ç›®å½•
- [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
- [å¿«é€Ÿéƒ¨ç½²](#å¿«é€Ÿéƒ¨ç½²)
- [Dockeréƒ¨ç½²](#dockeréƒ¨ç½²)
- [æ‰‹åŠ¨éƒ¨ç½²](#æ‰‹åŠ¨éƒ¨ç½²)
- [SSLé…ç½®](#sslé…ç½®)
- [å¤‡ä»½ç­–ç•¥](#å¤‡ä»½ç­–ç•¥)
- [ç›‘æŽ§ç»´æŠ¤](#ç›‘æŽ§ç»´æŠ¤)
- [æ•…éšœæŽ’é™¤](#æ•…éšœæŽ’é™¤)

## ç³»ç»Ÿè¦æ±‚

### æœ€ä½Žé…ç½®
- **CPU**: 1æ ¸
- **å†…å­˜**: 1GB
- **å­˜å‚¨**: 10GB
- **ç³»ç»Ÿ**: Ubuntu 20.04+, CentOS 7+, Debian 10+

### æŽ¨èé…ç½®
- **CPU**: 2æ ¸
- **å†…å­˜**: 2GB
- **å­˜å‚¨**: 20GB
- **å¸¦å®½**: 5Mbps+

### è½¯ä»¶è¦æ±‚
- Python 3.8+
- Nginx
- Git
- SSLè¯ä¹¦ (ç”Ÿäº§çŽ¯å¢ƒå¿…éœ€)

## å¿«é€Ÿéƒ¨ç½² ðŸš€

### æ–¹å¼ä¸€ï¼šä¸€é”®è‡ªåŠ¨éƒ¨ç½²è„šæœ¬

```bash
# 1. ä¸‹è½½éƒ¨ç½²è„šæœ¬
wget https://raw.githubusercontent.com/qdmz/webchaxun/main/deploy/deploy.sh

# 2. ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh

# 3. è¿è¡Œéƒ¨ç½²è„šæœ¬ (æ›¿æ¢ä¸ºæ‚¨çš„åŸŸåå’Œé‚®ç®±)
./deploy.sh your-domain.com admin@example.com
```

### æ–¹å¼äºŒï¼šä½¿ç”¨CloudStudio (æŽ¨è)

å¦‚æžœæ‚¨ä½¿ç”¨è…¾è®¯äº‘CloudStudioï¼Œå¯ä»¥ç›´æŽ¥ï¼š

1. åœ¨CloudStudioä¸­åˆ›å»ºå·¥ä½œç©ºé—´
2. å…‹éš†ä»£ç ï¼š`git clone https://github.com/qdmz/webchaxun.git`
3. è¿›å…¥é¡¹ç›®ç›®å½•ï¼š`cd webchaxun`
4. è¿è¡Œéƒ¨ç½²è„šæœ¬ï¼š`bash deploy/deploy.sh your-domain.com admin@example.com`

## Dockeréƒ¨ç½² ðŸ³

### 1. å®‰è£…Dockerå’ŒDocker Compose

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install docker.io docker-compose -y
sudo systemctl enable docker
sudo usermod -aG docker $USER

# CentOS
sudo yum install docker docker-compose -y
sudo systemctl enable docker
sudo usermod -aG docker $USER
```

### 2. é…ç½®DockerçŽ¯å¢ƒ

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd webchaxun/deploy

# å¤åˆ¶çŽ¯å¢ƒé…ç½®æ–‡ä»¶
cp docker.env.example docker.env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano docker.env
```

ç¼–è¾‘ `docker.env` æ–‡ä»¶ï¼š
```env
# Flaské…ç½®
SECRET_KEY=your-secret-key-change-in-production
FLASK_ENV=production

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://webchaxun:password@db:5432/webchaxun
POSTGRES_DB=webchaxun
POSTGRES_USER=webchaxun
POSTGRES_PASSWORD=password

# åŸŸåé…ç½®
DOMAIN=your-domain.com
```

### 3. å¯åŠ¨DockeræœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### 4. é…ç½®Nginxå’ŒSSL

```bash
# å¤åˆ¶Nginxé…ç½®
sudo cp nginx/nginx.conf /etc/nginx/nginx.conf
sudo cp nginx/webchaxun.conf /etc/nginx/sites-available/

# ä¿®æ”¹åŸŸå
sudo sed -i 's/your-domain.com/your-actual-domain.com/g' /etc/nginx/sites-available/webchaxun.conf

# å¯ç”¨ç«™ç‚¹
sudo ln -sf /etc/nginx/sites-available/webchaxun.conf /etc/nginx/sites-enabled/
sudo nginx -t

# é…ç½®SSL (è§SSLé…ç½®éƒ¨åˆ†)
bash scripts/ssl-setup.sh your-actual-domain.com admin@example.com

# é‡å¯Nginx
sudo systemctl reload nginx
```

## æ‰‹åŠ¨éƒ¨ç½² ðŸ› ï¸

### 1. æœåŠ¡å™¨å‡†å¤‡

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…ä¾èµ–
sudo apt install python3 python3-pip python3-venv git nginx -y

# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/webchaxun
sudo chown $USER:$USER /var/www/webchaxun
```

### 2. éƒ¨ç½²åº”ç”¨

```bash
# å…‹éš†ä»£ç 
git clone https://github.com/qdmz/webchaxun.git /var/www/webchaxun
cd /var/www/webchaxun

# åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®çŽ¯å¢ƒ
cp .env.example .env
nano .env  # ä¿®æ”¹é…ç½®

# åˆå§‹åŒ–åº”ç”¨
python install.py
```

### 3. é…ç½®Gunicorn

```bash
# åˆ›å»ºGunicorné…ç½®æ–‡ä»¶
cat > gunicorn.conf.py << EOF
bind = "127.0.0.1:8000"
workers = 4
worker_class = "sync"
worker_connections = 1000
max_requests = 1000
max_requests_jitter = 100
timeout = 120
keepalive = 2
preload_app = True
EOF
```

### 4. é…ç½®systemdæœåŠ¡

```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
sudo cp deploy/systemd/webchaxun.service /etc/systemd/system/

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable webchaxun
sudo systemctl start webchaxun
```

### 5. é…ç½®Nginx

```bash
# å¤åˆ¶Nginxé…ç½®
sudo cp deploy/nginx/webchaxun.conf /etc/nginx/sites-available/

# ä¿®æ”¹åŸŸå
sudo sed -i 's/your-domain.com/your-actual-domain.com/g' /etc/nginx/sites-available/webchaxun.conf

# å¯ç”¨ç«™ç‚¹
sudo ln -sf /etc/nginx/sites-available/webchaxun.conf /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default

# æµ‹è¯•å¹¶å¯åŠ¨Nginx
sudo nginx -t
sudo systemctl restart nginx
```

## SSLé…ç½® ðŸ”’

### Let's Encryptè¯ä¹¦ (æŽ¨è)

```bash
# æ–¹æ³•1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬
bash deploy/scripts/ssl-setup.sh your-domain.com admin@example.com

# æ–¹æ³•2: æ‰‹åŠ¨é…ç½®
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet --post-hook 'systemctl reload nginx'
```

### è‡ªç­¾åè¯ä¹¦ (æµ‹è¯•ç”¨)

```bash
# ä½¿ç”¨è„šæœ¬ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
bash deploy/scripts/ssl-setup.sh your-domain.com admin@example.com self-signed
```

## å¤‡ä»½ç­–ç•¥ ðŸ’¾

### è‡ªåŠ¨å¤‡ä»½è®¾ç½®

```bash
# å¤åˆ¶å¤‡ä»½è„šæœ¬
sudo cp deploy/scripts/backup.sh /usr/local/bin/backup-webchaxun.sh
sudo chmod +x /usr/local/bin/backup-webchaxun.sh

# è®¾ç½®æ¯æ—¥å¤‡ä»½
sudo crontab -e
# æ·»åŠ : 0 2 * * * /usr/local/bin/backup-webchaxun.sh
```

### æ‰‹åŠ¨å¤‡ä»½

```bash
# ç«‹å³æ‰§è¡Œå¤‡ä»½
sudo /usr/local/bin/backup-webchaxun.sh

# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
ls -la /var/backups/webchaxun/
```

### æ¢å¤å¤‡ä»½

```bash
# æ¢å¤æ•°æ®åº“
sudo cp /var/backups/webchaxun/webchaxun_YYYYMMDD_HHMMSS.db.gz /var/www/webchaxun/
sudo gunzip webchaxun_YYYYMMDD_HHMMSS.db.gz

# æ¢å¤ä¸Šä¼ æ–‡ä»¶
sudo tar -xzf /var/backups/webchaxun/uploads_YYYYMMDD_HHMMSS.tar.gz -C /var/www/webchaxun/
```

## ç›‘æŽ§ç»´æŠ¤ ðŸ“Š

### ç³»ç»Ÿç›‘æŽ§

```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
df -h
free -h

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status webchaxun
sudo systemctl status nginx

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u webchaxun -f
sudo tail -f /var/log/nginx/webchaxun.access.log
```

### æ€§èƒ½ä¼˜åŒ–

```bash
# è°ƒæ•´Gunicornå·¥ä½œè¿›ç¨‹æ•°
# ç¼–è¾‘ /etc/systemd/system/webchaxun.service
# ä¿®æ”¹ -w å‚æ•°ä¸ºCPUæ ¸å¿ƒæ•°çš„2-4å€

# ä¼˜åŒ–Nginxé…ç½®
# ç¼–è¾‘ /etc/nginx/nginx.conf
# è°ƒæ•´worker_processeså’Œworker_connections

# æ•°æ®åº“ä¼˜åŒ–
# å¯¹äºŽå¤§æ•°æ®é‡ï¼Œè€ƒè™‘ä½¿ç”¨PostgreSQLæ›¿ä»£SQLite
```

### æ—¥å¿—è½®è½¬

```bash
# åˆ›å»ºæ—¥å¿—è½®è½¬é…ç½®
sudo tee /etc/logrotate.d/webchaxun << EOF
/var/www/webchaxun/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    postrotate
        systemctl reload webchaxun
    endscript
}
EOF
```

## æ•…éšœæŽ’é™¤ ðŸ”§

### å¸¸è§é—®é¢˜

#### 1. ç«™ç‚¹æ— æ³•è®¿é—®

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status webchaxun nginx

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :80
sudo netstat -tlnp | grep :443

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
# æˆ–
sudo firewall-cmd --list-all

# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t
```

#### 2. SSLè¯ä¹¦é—®é¢˜

```bash
# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
sudo openssl x509 -in /etc/letsencrypt/live/your-domain.com/fullchain.pem -noout -enddate

# æµ‹è¯•è¯ä¹¦
sudo certbot certificates

# æ‰‹åŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

#### 3. æ•°æ®åº“é”™è¯¯

```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -la /var/www/webchaxun/webchaxun.db

# æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
sqlite3 /var/www/webchaxun/webchaxun.db "PRAGMA integrity_check;"
```

#### 4. æ–‡ä»¶ä¸Šä¼ å¤±è´¥

```bash
# æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
ls -la /var/www/webchaxun/uploads/

# ä¿®å¤æƒé™
sudo chown -R www-data:www-data /var/www/webchaxun/uploads/
sudo chmod -R 755 /var/www/webchaxun/uploads/
```

### æ€§èƒ½é—®é¢˜æŽ’æŸ¥

```bash
# æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½
uptime
top

# æŸ¥çœ‹ç£ç›˜IO
iotop

# æŸ¥çœ‹ç½‘ç»œè¿žæŽ¥
ss -tuln

# åˆ†æžNginxæ—¥å¿—
sudo awk '{print $1}' /var/log/nginx/webchaxun.access.log | sort | uniq -c | sort -nr
```

### å®‰å…¨åŠ å›º

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# é…ç½®é˜²ç«å¢™
sudo ufw enable
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡
sudo systemctl disable apache2
sudo systemctl stop apache2

# å®šæœŸå®‰å…¨æ‰«æ
sudo apt install lynis
sudo lynis audit system
```

## æ‰©å±•éƒ¨ç½²

### è´Ÿè½½å‡è¡¡éƒ¨ç½²

```bash
# å¤šä¸ªåŽç«¯æœåŠ¡
# ä¿®æ”¹Nginxé…ç½®æ·»åŠ upstream
upstream webchaxun_backend {
    server 127.0.0.1:8000;
    server 127.0.0.1:8001;
    server 127.0.0.1:8002;
}
```

### æ•°æ®åº“å‡çº§

```bash
# è¿ç§»åˆ°PostgreSQL
sudo apt install postgresql postgresql-contrib
sudo -u postgres createdb webchaxun
sudo -u postgres createuser webchaxun

# ä¿®æ”¹.envæ–‡ä»¶ä¸­çš„DATABASE_URL
# DATABASE_URL=postgresql://webchaxun:password@localhost/webchaxun
```

## æ”¯æŒä¸Žå¸®åŠ©

å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ï¼šhttps://github.com/qdmz/webchaxun
2. æäº¤Issueï¼šhttps://github.com/qdmz/webchaxun/issues
3. é‚®ä»¶è”ç³»ï¼šqdmz@vip.qq.com

---

**æ³¨æ„**: åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­éƒ¨ç½²å‰ï¼Œè¯·åŠ¡å¿…ï¼š
- ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
- é…ç½®å¼ºå¯†ç ç­–ç•¥
- å¯ç”¨é˜²ç«å¢™
- é…ç½®SSLè¯ä¹¦
- è®¾ç½®å¤‡ä»½ç­–ç•¥
- é…ç½®ç›‘æŽ§å‘Šè­¦
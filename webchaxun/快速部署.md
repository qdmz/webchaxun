# Web查询系统 - 快速部署指南

## 一键安装

### Windows系统

```batch
@echo off
echo 正在安装Web查询系统...

REM 创建虚拟环境
python -m venv venv
call venv\Scripts\activate

REM 安装依赖
pip install -r requirements.txt

REM 复制环境配置文件
copy .env.example .env

REM 初始化数据库和系统
python install.py

echo 安装完成！运行 python run.py 启动系统
pause
```

### Linux/Mac系统

```bash
#!/bin/bash
echo "正在安装Web查询系统..."

# 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 复制环境配置文件
cp .env.example .env

# 初始化数据库和系统
python install.py

echo "安装完成！运行 python run.py 启动系统"
```

## 快速启动

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **初始化系统**
   ```bash
   python install.py
   ```

3. **启动应用**
   ```bash
   python run.py
   ```

4. **访问系统**
   - 地址: http://localhost:5000
   - 管理员: admin / admin123

## Docker部署

创建 `Dockerfile`:

```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

RUN mkdir -p uploads logs

EXPOSE 5000

CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:5000", "run:app"]
```

创建 `docker-compose.yml`:

```yaml
version: '3.8'

services:
  webchaxun:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - ./uploads:/app/uploads
      - ./logs:/app/logs
      - ./webchaxun.db:/app/webchaxun.db
    environment:
      - FLASK_ENV=production
      - SECRET_KEY=your-secret-key-here
    restart: unless-stopped
```

部署命令:
```bash
docker-compose up -d
```

## 生产环境部署

### 使用Nginx + Gunicorn

1. **安装Gunicorn**
   ```bash
   pip install gunicorn
   ```

2. **启动Gunicorn**
   ```bash
   gunicorn -w 4 -b 127.0.0.1:5000 run:app
   ```

3. **配置Nginx**
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;
       
       location / {
           proxy_pass http://127.0.0.1:5000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
       
       location /static {
           alias /path/to/webchaxun/static;
       }
   }
   ```

### 使用systemd管理

创建服务文件 `/etc/systemd/system/webchaxun.service`:

```ini
[Unit]
Description=Web查询系统
After=network.target

[Service]
Type=exec
User=www-data
Group=www-data
WorkingDirectory=/path/to/webchaxun
Environment=PATH=/path/to/webchaxun/venv/bin
ExecStart=/path/to/webchaxun/venv/bin/gunicorn -w 4 -b 127.0.0.1:5000 run:app
Restart=always

[Install]
WantedBy=multi-user.target
```

启动服务:
```bash
sudo systemctl enable webchaxun
sudo systemctl start webchaxun
```

## 注意事项

1. **安全设置**
   - 修改默认管理员密码
   - 更改SECRET_KEY
   - 设置适当的文件权限

2. **性能优化**
   - 使用PostgreSQL或MySQL替代SQLite
   - 配置Redis缓存（如需要）
   - 设置文件上传大小限制

3. **备份策略**
   - 定期备份数据库
   - 备份上传的Excel文件
   - 备份配置文件

4. **日志监控**
   - 监控应用日志
   - 设置错误报警
   - 定期清理日志文件

## 常见问题解决

### 数据库连接错误
检查 `DATABASE_URL` 配置是否正确。

### 文件上传失败
- 检查 `uploads` 目录权限
- 检查文件大小限制
- 检查磁盘空间

### 内存不足
- 减少Gunicorn工作进程数
- 优化Excel文件处理
- 增加服务器内存

获取更多帮助，请查看 [README.md](README.md) 文件。